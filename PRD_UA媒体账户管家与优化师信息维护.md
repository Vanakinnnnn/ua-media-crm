# UA媒体账户管家与优化师信息维护 PRD

---

##角色定位

你是一个经验丰富的UI设计工程师和前端开发者，擅长创建简洁、功能强大的CRM系统。现在，你需要开发一个在公司内部管理各个媒体平台广告投放账户的平台。需要维护各个主账户信息、负责投放的优化师的信息，以及记录操作日志等，详细需求描述如下。也请随着我们的交流，随时更新这篇PRD。


## 一、产品背景与目标

随着UA自动化流程逐步增多，当前媒体账户和优化师信息依赖人工维护，AM需手动通知中台开发更新数据库，存在时效性差、透明度低、人员流动导致数据滞后等问题。涉及媒体包括Unity、Applovin、TikTok、Facebook、Google Ads等。

**目标**：
- 在HBG创建一个自动化界面，统一管理投放账户、媒体主体与优化师的信息，实现信息自动化同步。
- 提升信息更新的便捷性和工作效率，减少离线数据带来的中台数据滞后信息断层。
- 支持批量导入、权限映射、日志追溯、数据同步与备份。

---

## 二、用户角色
- **AM**：负责信息录入、更新、提交刷新申请。
- **中台**：接收数据更新通知，执行数据同步。
- **管理员**：可追溯操作日志，管理权限。

---

## 三、产品结构与页面导航

1. 媒体账户管理
   - 媒体账户列表页
   - 新增/编辑媒体账户弹窗
2. 账户权限管理
   - 权限矩阵页面
   - 权限审计页面
   - 权限模板管理
3. 优化师信息管理
   - 优化师列表页
   - 新增/编辑优化师弹窗
4. 操作日志
   - 日志列表页
5. 全局操作
   - 顶部导航栏（页面切换、刷新、退出登录等）

---

## 四、功能模块与页面说明

### 1. 媒体账户管理

#### 1.1 媒体账户列表页
- 展示所有媒体账户的关键信息（媒体类型、主账户ID、部门、状态、上次更新时间等）
- 支持多条件筛选（媒体类型、部门、状态等）
- 支持关键字搜索（账户名、ID等）
- 支持分页浏览
- 支持“新增媒体账户”按钮，弹出新增表单
- 每行支持“编辑”操作，弹出编辑表单
- 支持“申请刷新”操作，触发数据同步

**字段说明**：
- 媒体类型（下拉选择：Google Ads、Facebook、TikTok、Unity、Applovin、Moloco等）
- 主账户名/ID（必填，唯一性校验）
- 部门（多选标签，支持自定义）
- 账户配置（如MCC类型、Payment profile ID等，按媒体类型动态展示）
- 状态（自动/手动维护，active/closed）
- 上次信息更新时间（系统自动记录）

| 媒体         | 包含信息                                 | 编辑权限                                    |
| ------------ | ---------------------------------------- | ---------------------------------------- |
| Google Ads   | MCC类型（主/子MCC)、Payment profile ID | 主MCC仅可编辑Payment Profile ID；子MCC不可编辑配置 |
| Facebook     | 显示"-"（无配置项）                                     | 无配置项可编辑                                          |
| Tiktok       | Industry ID、Business Type、Billing Group ID | BC账户可编辑所有配置项        |
| Applovin     | 显示"-"（无配置项）                                     | 无配置项可编辑                                          |
| Unity        | 显示"-"（无配置项）                                     | 无配置项可编辑                                          |
| Moloco       | 显示"-"（无配置项）                                     | 无配置项可编辑                                          |

- FG信息：DH ID、环境（完全只读，不可编辑）
- 状态、上次信息更新时间

**交互细节**：
- 新增/编辑弹窗内字段有必填校验，主账户ID唯一性校验
- “申请刷新”后，页面有loading提示，刷新结果有toast反馈
- FG信息（DHID、Environment）在所有平台均为只读状态，不可编辑
- 编辑权限严格按照平台类型和账户级别控制（详见1.2编辑权限控制章节）

#### 1.3 新增/编辑媒体账户弹窗
- 支持新增和编辑媒体账户信息
- 动态展示不同媒体类型下的专属字段
- 支持部门多选、标签输入
- 支持配置账户信息（如Google Ads的主/子MCC、Payment profile ID等）

**校验规则**：
- 必填项未填写时，禁止提交
- 主账户ID不可重复
- 配置字段按媒体类型校验格式

#### 1.2 媒体账户编辑权限控制（2024-更新）

为确保数据安全性和业务逻辑正确性，系统对不同媒体平台和账户类型实施精细化的编辑权限控制：

##### 权限控制总表
| 平台类型 | 账户信息(名称/ID) | 部门 | 状态 | 账户配置 | FG信息(DHID/ENV) |
|---------|------------------|------|------|----------|-------------------|
| **Google主MCC** | ❌ 不可编辑 | ❌ 由子账户决定 | ❌ 不可编辑 | ✅ 仅Payment Profile ID | ❌ 完全只读 |
| **Google子MCC** | ✅ 可编辑 | ✅ 可编辑 | ✅ 可编辑 | ❌ 继承主MCC | ❌ 完全只读 |
| **TikTok BC** | ✅ 可编辑 | ✅ 可编辑 | ✅ 可编辑 | ✅ 全部配置项 | ❌ 完全只读 |
| **Facebook等其他** | ❌ 不可编辑 | ✅ 仅部门可编辑 | ❌ 不可编辑 | ❌ 显示"-" | ❌ 完全只读 |

##### 详细权限说明

**Google Ads平台**：
- **主MCC账户**：
  - 账户信息：账户名称和ID均不可编辑（保持主账户信息稳定性）
  - 部门：不可编辑，系统自动汇总其所有子账户的部门信息
  - 状态：不可编辑（主账户状态由系统维护）
  - 账户配置：仅允许编辑Payment Profile ID，MCC Type不可更改
  - FG信息：DHID和Environment完全只读
- **子MCC账户**：
  - 账户信息：可编辑账户名称和账户ID
  - 部门：可编辑，支持多选
  - 状态：可编辑（Active/Closed）
  - 账户配置：Payment Profile ID继承主账户不可编辑，MCC Type不可更改
  - FG信息：DHID和Environment完全只读

**TikTok平台（BC账户）**：
- 账户信息：可编辑账户名称和账户ID
- 部门：可编辑，支持多选
- 状态：可编辑（Active/Closed）
- 账户配置：可编辑Industry ID、Business Type、Billing Group ID
- FG信息：DHID和Environment完全只读

**Facebook及其他媒体平台**：
- 账户信息：不可编辑（保持API数据一致性）
- 部门：可编辑，这是唯一可修改的字段
- 状态：不可编辑（由API数据决定）
- 账户配置：列显示为空("-")，无配置项可编辑
- FG信息：DHID和Environment完全只读

##### 业务逻辑说明
1. **继承关系**：Google Ads子账户的Payment Profile ID、DHID、Environment继承主账户
2. **部门汇总**：Google Ads主账户部门为其所有子账户部门的并集
3. **数据一致性**：Facebook等通过API获取的数据仅允许修改部门归属
4. **安全性**：FG信息作为系统集成关键字段，全平台禁止手动编辑

#### 1.4 Facebook账户子模块
- 管理及更新各Facebook BM下ad account的角色（Owner或client）
- 字段：BM Name、BM ID、Ad account Name+ID、Role（Facebook API获取）、上次更新时间
- 支持通过账户ID/名称/角色筛选和搜索
- 申请刷新（不可手动修改）
- 信息获取：直接由媒体API抓取
- API文档：[Facebook官方文档](https://developers.facebook.com/docs/marketing-api/business-asset-management/guides/ad-accounts/)

### Google Ads主子账户平铺展示与筛选联动（2024-更新）
- Google Ads账户在列表中主账户和子账户平铺展示，主账户永远在其子账户之上。
- 无论筛选条件如何，若筛选结果包含子账户，则自动展示其主账户（主子账户成对展示）。
- 采用边框包围的视觉设计：每个主账户组用蓝色边框包围，主账户使用浅蓝背景突出显示。
- MCC Type字段采用醒目的彩色标签样式：主MCC为蓝色背景，子MCC为绿色背景。
- 账户配置中不显示"主MCC ID"字段（主账户和子账户均不显示）。
- 其他平台账户展示方式不变。

### 筛选器与搜索功能（2024-更新）
#### 筛选器组件：
1. **状态筛选**：下拉单选（全部、Active、Closed）
2. **媒体类型筛选**：自定义下拉多选组件
   - 支持展开菜单、对号选中标识
   - 选中项以蓝色标签形式显示在输入框内
   - 支持全选/全不选功能
   - 支持点击标签内×删除单个项目
   - 选项：Facebook、Google Ads、TikTok、Applovin、Unity、Moloco
3. **部门筛选**：自定义下拉多选组件（功能同媒体类型筛选器）
   - 选项：010、045、055、060、919

#### 综合搜索功能：
- **搜索范围**：精准关键词匹配以下账户信息字段
  - 基本信息：账户名称、账户ID、公司名称
  - 账户配置：Payment Profile ID、MCC类型
  - 媒体特定字段：Industry ID、Business Type、Billing Group ID
  - FG信息：DHID、Environment
  - 注意：主MCC ID不参与常规搜索，有专门的精准匹配逻辑
- **不参与搜索的字段**：账户状态、媒体类型、部门（这些有专门的筛选器）
- **高亮显示**：匹配的关键词用黄色背景高亮标识
- **搜索逻辑**：
  - 支持子账户ID搜索（如搜索"SUB-001"可找到Gaming Division）
  - 主MCC ID精准匹配逻辑：当搜索关键词与某个主MCC的账户ID精准匹配时，自动展示该主MCC下的所有子账户（子账户仍受其他筛选条件如状态、媒体类型、部门等限制）

#### 筛选器交互流程：
1. **输入阶段**：用户在各筛选器中输入/选择条件，此时不立即应用筛选
2. **手动触发**：点击"筛选"按钮后才应用所有筛选条件
3. **状态反馈**：应用筛选后显示当前生效的筛选条件标签
   - 状态筛选：绿色标签
   - 媒体类型：蓝色标签  
   - 部门筛选：紫色标签
   - 搜索关键词：黄色标签
4. **重置功能**：点击"重置"按钮清空所有筛选条件（包括用户输入和已应用的筛选）

#### 筛选器技术特性：
- **双状态管理**：临时状态（用户输入）+ 应用状态（实际筛选）
- **组合筛选**：所有筛选条件使用AND逻辑组合
- **性能优化**：仅在点击筛选按钮时重新计算筛选结果
- **Google Ads特殊处理**：筛选结果包含子账户时自动补充其主账户（主子账户成对展示）
- **用户体验**：清晰的视觉反馈，避免输入过程中表格内容频繁变化

---

### 2. 账户权限管理

#### 2.1 权限矩阵页面
- 统一展示所有媒体平台的账户权限关系
- 按账户层级展示，每个账户下可展开查看拥有权限的优化师
- 支持多维度筛选（平台、部门、优化师状态等）
- 支持综合搜索（账户名、优化师、容器信息等）
- 所有数据从API直接获取，不支持手动修改

**核心功能**：
- **双层展示结构**：
  - **账户层（外层）**：展示容器与账户的关系信息
    - MCC/BM/BC信息：名称、ID、媒体平台标识
    - 账户信息：账户名称、账户ID
    - 关系类型：Owner/Agency/Client（Facebook特殊区分，其他平台均为Owner）
    - 账户状态：Active/Closed
    - 部门归属：一个账户只能被一个部门拥有
    - 最后更新时间
    - 操作按钮：申请刷新（二次确认）
  - **优化师层（内层）**：展示具体优化师权限详情
    - 优化师姓名及公司内部邮箱
    - 媒体平台邮箱（优化师在对应平台使用的邮箱）
    - 账户权限配置（平台真实角色/任务）
    - 优化师状态（Active/Inactive）
- **Facebook特殊处理**：
  - 支持Owner/Agency关系区分
  - 同一账户可能被多个BM管理
- **权限关系结构**：容器（MCC/BM/BC）→ 账户 → 优化师三层关系清晰展示

**权限显示规范**：
| 平台 | 权限配置 | 显示样式 |
|------|---------|---------|
| Google Ads | STANDARD/ADMIN/READ_ONLY | 蓝色标签显示真实角色 |
| Facebook | ADVERTISE, ANALYZE | 绿色标签显示任务列表 |
| TikTok | BC:STANDARD + AD:ADMIN | 紫色+橙色双标签 |
| Unity/Applovin等 | 平台特定角色 | 灰色标签显示角色 |

#### 2.2 权限审计页面
- 权限异常监控和预警
- 孤立账户检测（有账户无优化师）
- 非活跃优化师权限检测
- 权限冲突检测

**审计项目**：
- **孤立账户**：有账户配置但无优化师分配的情况
- **非活跃优化师**：优化师状态为非活跃但仍有权限分配
- **权限冲突**：同一优化师在不同平台权限级别不一致

---

### 3. 优化师信息管理

#### 3.1 优化师列表页
- 展示所有优化师的关键信息（姓名、邮箱、部门、媒体权限、状态、上次更新时间等）
- 支持多条件筛选（部门、状态、媒体类型等）
- 支持关键字搜索（姓名、邮箱等）
- 支持分页浏览
- 支持“新增优化师”按钮，弹出新增表单
- 每行支持“编辑”操作，弹出编辑表单
- 支持“申请刷新”操作

**字段说明**：
- 优化师姓名（必填，唯一性校验）
- 工作邮箱（必填，邮箱格式校验）
- 部门（多选标签）
- 媒体权限（可添加多个媒体账号，支持Facebook、TikTok、Google Ads等，每个媒体账号下有账号/ID等字段）
- 培训平台账号邮箱（选填）
- 状态（active/closed）
- 上次更新时间（系统自动记录）

- 新增/编辑弹窗内支持动态添加/删除媒体权限
- 媒体账号信息支持批量导入
- “申请刷新”后有loading和结果反馈
- 优化师不可物理删除，只能“废弃”或“新增”

#### 3.2 新增/编辑优化师弹窗
- 支持新增和编辑优化师信息
- 支持动态添加多个媒体账号权限
- 支持部门多选、标签输入

**校验规则**：
- 姓名、邮箱必填且唯一
- 邮箱格式校验
- 媒体账号信息按类型校验格式

---

### 4. 操作日志
- 展示所有操作日志（时间、操作人、操作类型、模块、详情、状态等）
- 支持按时间、操作人、模块筛选
- 支持关键字搜索
- 支持分页浏览

**字段说明**：
- 时间（自动记录）
- 用户（操作人）
- 模块（媒体信息、优化师信息等）
- 操作类型（新增、编辑、刷新等）
- 详情（如“更新TikTok BCID”）
- 状态（已更新、未更新）

---

## 五、全局交互与体验
- 顶部导航栏支持页面切换、刷新、退出登录等操作
- 所有表单均有必填项校验、格式校验、唯一性校验
- 所有异步操作（如刷新、保存）均有loading和结果toast提示
- 支持多端适配（PC、移动端）

---

## 六、字段与校验规则
- 主账户ID/优化师邮箱/姓名：全局唯一
- 部门/标签：支持自定义输入，支持多选
- 媒体账号信息：按媒体类型校验格式（如Google Ads为xxx-xxx-xxx，Facebook为纯数字ID等）
- 状态：active/closed，部分由系统自动维护
- 上次更新时间：系统自动更新时间戳

---

## 七、典型用户场景
1. AM批量导入新媒体账户：通过“新增媒体账户”弹窗，批量填写主账户信息，选择部门，配置账户参数，提交后自动校验并入库。
2. 优化师权限变更：在优化师列表页，筛选目标优化师，编辑其媒体权限，动态添加/删除媒体账号，保存后自动校验并同步。
3. 数据同步与刷新：AM在任意页面点击“申请刷新”，系统自动同步最新数据到数据库，并在操作日志中记录本次操作。
4. 操作追溯：管理员可在操作日志页，按时间/操作人/模块筛选，快速定位历史操作详情。

---

## 八、权限与安全
- 仅AM和中台有操作权限，普通用户只读
- 所有操作均需登录，支持单点登录（SSO）对接
- 敏感操作（如批量导入、刷新）需二次确认

---

## 九、数据同步与备份
- 支持每日定时自动同步
- 支持手动触发同步
- 所有数据变更均有备份和恢复机制

---

## 十、附录
- 页面原型与交互可参考：[https://lustrous-daffodil-e7d54b.netlify.app/](https://lustrous-daffodil-e7d54b.netlify.app/)
- 字段、交互、校验规则如有变动，以产品实际页面为准
